#CROSS_COMPILE=arm-linux-gnueabihf-
PREFIX = @prefix@
DEBUG = "no"

CC = $(CROSS_COMPILE)gcc
AR = $(CROSS_COMPILE)ar
CFLAGS = -Wall -O0 -pthread

ifeq ($(DEBUG),"yes")
CFLAGS += -g -DPIAPI_DEBUG
endif

TARGET = getRawPower
LIBNAME = piapi

TESTOBJS = $(TARGET).o
STATICLIB = lib$(LIBNAME).a
OBJS = 	piapi.o     \
	piproxy.o   \
	piagent.o   \
	pinative.o  \
	piutil.o    \
	pidev.o     \
	proxy.o     \
	agent.o     \
	native.o    \
	test.o      \
	$(TARGET).o

all: lib $(TESTOBJS)
	$(CC) $(CFLAGS) $(TESTOBJS) -L. -l$(LIBNAME) -o $(TARGET)
	$(CC) $(CFLAGS) proxy.o -L. -l$(LIBNAME) -o proxy 
	$(CC) $(CFLAGS) agent.o -L. -l$(LIBNAME) -o agent 
	$(CC) $(CFLAGS) native.o -L. -l$(LIBNAME) -o native 
	$(CC) $(CFLAGS) test.o -L. -l$(LIBNAME) -o test

clean:
	rm -f out/* $(TARGET) proxy agent native test $(STATICLIB) $(OBJS)

lib: $(OBJS)
	$(AR) rcs $(STATICLIB) $(OBJS)
	
install:
	mkdir -p $(PREFIX)
	mkdir -p $(PREFIX)/include
	cp picommon.h piapi.h $(PREFIX)/include
	mkdir -p $(PREFIX)/lib
	cp libpiapi.a $(PREFIX)/lib
	mkdir -p $(PREFIX)/bin
	cp $(TARGET) proxy agent native logger test $(PREFIX)/bin
	cp -R script $(PREFIX)/script
